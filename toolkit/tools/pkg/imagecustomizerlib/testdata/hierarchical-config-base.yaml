previewFeatures:
- output-artifacts
- package-snapshot-time

input:
  image:
    path: testimages/empty-base.vhdx

output:
  image:
    path: ./out/output-image-1.vhdx
    format: vhdx
  artifacts:
    items:
    - ukis
    path: ./artifacts-1

storage:
  bootType: efi
  disks:
  - partitionTableType: gpt
    partitions:
    - id: esp
      type: esp
      size: 8M

    - id: usr
      size: 2G

    - id: usrhash
      size: 100M

  filesystems:
  - deviceId: esp
    type: fat32
    mountPoint:
      path: /boot/efi
      options: umask=0077

  - deviceId: verityusr
    type: ext4
    mountPoint:
      path: /usr
      options: ro

  verity:
  - id: verityusr
    name: usr
    dataDeviceId: usr
    hashDeviceId: usrhash

os:
  bootloader:
    resetType: hard-reset
  hostname: test-hostname-base
  users:
    - name: test-user-base
  groups:
    - name: test-group-base

  additionalFiles:
  - source: files/a.txt
    destination: /mnt/a/a.txt

  additionalDirs:
  - source: dirs/a
    destination: /

  packages:
    install:
    - nginx
    snapshotTime: 2025-09-18

  services:
    enable:
    - nginx
    - console-getty

  modules:
  - name: br_netfilter
    loadMode: always
  - name: vfio
    loadMode: always

  selinux:
    mode: permissive

  overlays:
  - mountPoint: /var
    lowerDirs:
    - /var
    upperDir: /mnt/overlays/var/upper
    workDir: /mnt/overlays/var/work

  kernelCommandLine:
    extraCommandLine:
    - "rd.info"
